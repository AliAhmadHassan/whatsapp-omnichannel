@{ 
    List<SelectListItem> situacoes_itens = new List<SelectListItem>();
    List<WWeb.UI.WebformMVC.Models.Situacao> situacoes = new List<WWeb.UI.WebformMVC.Models.Situacao>();
    int status = Convert.ToInt32(ViewBag.StatusClienteId);

    using (WWeb.UI.WebformMVC.Models.WWebEntities ctx = new WWeb.UI.WebformMVC.Models.WWebEntities())
    {
        situacoes = ctx.Situacao.Where(s => s.Bloqueado == false).ToList();
    }

    situacoes_itens.Add(new SelectListItem() { Text = "Selecione uma opção", Value = "0" });
    foreach (WWeb.UI.WebformMVC.Models.Situacao sit in situacoes.OrderBy(s => s.Descricao).ToList())
    {
        SelectListItem item = new SelectListItem() { Text = sit.Descricao.ToUpper(), Value = sit.Id.ToString(), Selected = status == sit.Id ? true : false };
        situacoes_itens.Add(item);
    }
}

@model IEnumerable<WWeb.UI.WebformMVC.Models.DTO.MensagemDTO>

    @*@System.Web.Optimization.Scripts.Render("~/bundles/jquery")
        @System.Web.Optimization.Scripts.Render("~/bundles/jqueryui")
        @System.Web.Optimization.Scripts.Render("~/bundles/jqueryval")
        @System.Web.Optimization.Scripts.Render("~/bundles/modernizr")*@
    @System.Web.Optimization.Scripts.Render("~/bundles/wweb")
    @System.Web.Optimization.Styles.Render("~/Content/themes/base/css")
    @System.Web.Optimization.Styles.Render("~/Content/Css")

    <input type="hidden" id="hdn_telefonecliente" value="@(ViewBag.TelefoneCliente)">

    <table cellpadding="2" cellspacing="1" style="width:100%; height:170px; padding:0px; color:#333333;">
        <tr>
            @*<td rowspan="4" style="width:165px;padding:1px;">
                @{
                    var base64 = Convert.ToBase64String(ViewBag.FotoCliente);
                    var imgSrc = String.Format("data:image/gif;base64,{0}", base64);
                }

                <img src="@imgSrc" style="width:160px; height:160px; position:absolute; margin-top:-80px; border:5px solid #efefef;z-index:9999999;" id="img-foto" />
            </td>*@
        </tr>
        <tr>
            <td style="height:45px; padding-left:20px;border-bottom:1px solid #efefef;">
                <span style="font-size:12px;">
                    <strong>Nome Cliente</strong>
                </span><br />
                <input type="text" id="txt_nomecliente" style="border:none; width:100%; font-size:30px; color:#555555;" value="@(ViewBag.NomeCliente)" />
            </td>
        </tr>
        <tr>
            <td style="padding:0;height:40px; padding-left:20px; vertical-align:bottom;border-bottom:1px solid #efefef;">
                <table style="width:50%;">
                    <tr>
                        <td style="width:50%;border-right:1px solid #efefef;color:#555555;">
                            <span style="font-size:12px;color:#333333;"><strong>Telefone</strong></span><br />
                            @(ViewBag.TelefoneCliente)
                        </td>
                        <td style="width:50%;color:#555555;">
                            <span style="font-size:12px;color:#333333;"><strong>CPF/CNPJ</strong></span><br />
                            <input type="text" id="txt_cpfcliente" style="border:none; width:100%;padding:5px;" value="@(ViewBag.CpfCliente)" />
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td style="padding:0;height:40px; padding-left:20px; vertical-align:bottom;border-bottom:1px solid #efefef;" valign="top">
                <table style="width:100%">
                    <tr>
                        <td style="width:50%;border-right:1px solid #efefef;color:#555555;font-size:16px;" valign="top">
                            <span style="font-size:12px;color:#333333;"><strong>Situação da Conversa</strong></span><br />
                            <span style="width:280px; height:30px; border:0px solid #efefef; color:#666666;font-size:16px;">
                                @Html.DropDownList("Sit_ID", situacoes_itens, new { @style = "width:280px; height:30px; border:0px solid #efefef; color:#666666;font-size:16px;", @id = "Sit_ID" })
                            </span>
                        </td>
                        <td style="width:50%;color:#555555;text-align:right" align="right">
                            <img src="~/Content/img/btn-atualizar-cliente.png" style="margin-left:15px; width:40px; cursor:pointer;" title="Atualizar os dados do cliente" id="btn_atualizar_nome" />
                            <br /><span id="span-mensagem" style="color:deepskyblue; font-size:11px;"></span>
                        </td>
                    </tr>
                </table>

            </td>
        </tr>
    </table>

    <div id="tabela" class="grid" style="border:1px solid #efefef;">
        <br />
        <table class="footable" data-page-size="10" style="width:800px;">
            <caption>
                &nbsp;&nbsp;&nbsp;&nbsp;Mensagens Encontradas para o telefone: @(ViewBag.Telefone)
            </caption>

            <thead>
                <tr>
                    <th style="width:50px;">
                        Id
                    </th>
                    <th style="width:150px;">Data</th>
                    <th>Tipo</th>
                    <th>Mensagem</th>
                </tr>
            </thead>
            <tbody>
                @foreach (WWeb.UI.WebformMVC.Models.DTO.MensagemDTO item in Model)
                {
                    <tr>
                        <td>
                            @(item.Id)
                        </td>
                        <td>
                            @(item.DataMensagem)
                        </td>
                        <td>
                            @if (item.Tipo == 2)
                            {
                            <span>Cliente</span>
                            }
                            else
                            {
                            <span>Orcozol</span>
                            }

                        </td>
                        <td>
                            @Html.Raw(item.Mensagem)
                        </td>
                    </tr>
                }
            </tbody>
            <tfoot class="hide-if-no-paging" style="text-align:center">
                <tr>
                    <td colspan="4" style="height:30px; text-align:center; background-color:#cccccc; color:#444444; line-height:30px;">
                        Registro(s) Encontrado(s): @Model.Count().ToString("0000")
                        <div class="pagination pagination-centered"></div>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>

